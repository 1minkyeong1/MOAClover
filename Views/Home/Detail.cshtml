@model MOAClover.Models.ViewModels.ProductDetailViewModel

@{
    ViewData["Title"] = "상품페이지";
}

<link rel="stylesheet" href="~/css/Detail.css" />

<div class="detail-wrap">

    <!-- 상단 -->
    <div class="detail-top">

        <!-- 왼쪽 이미지 -->
        <div class="detail-left">
            <img src="@Model.MainImageUrl" class="main-img" />

            <div class="thumbnail-wrap">
                @foreach (var img in Model.ImageUrls)  // 이제 8장만 들어있음
                {
                    <img src="@img" class="thumb" onclick="changeImage(this.src)" />
                }
            </div>
        </div>

        <!-- 오른쪽 상품정보 -->
        <div class="detail-right">
            <div class="category-info">
                <span>@Model.CategoryPath</span>
            </div>

            <h1>@Model.Name</h1>

            <!-- 가격 -->
            <div class="detail-price">
                @if (Model.DiscountRate.HasValue && Model.DiscountRate.Value > 0)
                {
                    <div class="detail-price-row">
                        <div class="rate-big">@Model.DiscountRate%</div>

                        <div class="price-right">
                            <div class="price-line">
                                <span class="origin">@Model.Price.ToString("N0")원</span>
                                <span class="sale">@Model.FinalPrice.ToString("N0")원</span>
                            </div>

                            <div class="ship-line">
                                <span class="ship-icon">🚚</span>
                                <span class="ship-text">무료배송</span>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="detail-price-row">
                        <div class="price-right">
                            <div class="price-line">
                                <span class="sale">@Model.Price.ToString("N0")원</span>
                            </div>

                            <div class="ship-line">
                                <span class="ship-icon">🚚</span>
                                <span class="ship-text">4,000원</span>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <a href="https://smartstore.naver.com"
               target="_blank"
               class="external-link">
                스마트스토어
            </a>

            <!-- 수정,삭제 버튼 -->
            @if (User.IsInRole("admin"))
            {
                <div style="margin-top:120px; display:flex; justify-content: flex-end; gap:12px; padding-top: 16px;">
                    <a class="btn btn-outline-primary" style="padding: 8px 27px;"
                       asp-controller="Home" asp-action="Edit" asp-route-id="@Model.ProductId">
                        수정
                    </a>

                    <a class="btn btn-outline-danger" style="padding: 8px 27px;"
                       asp-controller="Home" asp-action="Delete" asp-route-id="@Model.ProductId">
                        삭제
                    </a>
                </div>
            }

        </div>       
    </div>

    <!-- 탭 -->
    <div class="tab-menu">
        <div class="tab active" onclick="openTab(this,'detail')">상세정보</div>
        <div class="tab" onclick="openTab(this,'qa')">Q&A</div>
        <div class="tab" onclick="openTab(this,'return')">반품/교환</div>
    </div>

    <!-- 탭 내용 -->
    <div class="tab-content">

        <!-- 상세정보 -->
        <div id="detail" class="tab-panel active detail-html">

            @if (Model.DetailImageUrls.Any())
            {
                foreach (var img in Model.DetailImageUrls)
                {
                    <img src="@img" />
                }
            }

            @if (Model.VideoUrls.Any())
            {
                foreach (var video in Model.VideoUrls)
                {
                    <video src="@video" controls></video>
                }
            }

            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="text-desc">
                    @Html.Raw(Model.Description)
                </div>
            }

        </div>

        <!-- Q&A 탭 -->
        <div id="qa" class="tab-panel">
            <div id="qna-root" data-product-id="@Model.ProductId">

                <div class="qna-toolbar">
                    <button type="button" id="btnShowQnaForm">문의등록</button>
                </div>

                <div id="qna-form-area" class="hidden">
                    @await Html.PartialAsync("~/Views/Home/QnAForm.cshtml", Model)
                </div>

                <div id="qna-list-area">
                    @await Html.PartialAsync("~/Views/Home/QnA.cshtml", Model)
                </div>

            </div>
        </div>

        <!-- 반품/교환 -->
        <div id="return" class="tab-panel return-policy">

            <h3>반품 / 교환 안내</h3>

            <ul>
                <li>
                    <strong>반품/교환 가능 기간</strong><br />
                    상품 수령일로부터 <b>7일 이내</b>에 신청 가능합니다.
                </li>

                <li>
                    <strong>반품/교환 불가 사유</strong>
                    <ul class="sub">
                        <li>고객 부주의로 인한 상품 훼손 또는 사용 흔적이 있는 경우</li>
                        <li>상품 택(tag) 및 구성품이 분실 또는 훼손된 경우</li>
                        <li>주문 제작 상품 및 세일 상품</li>
                    </ul>
                </li>

                <li>
                    <strong>배송비 안내</strong><br />
                    단순 변심에 의한 반품/교환 시 왕복 배송비는 고객 부담입니다.<br />
                    상품 불량 및 오배송의 경우 배송비는 <b>판매자 부담</b>입니다.
                </li>

                <li>
                    <strong>반품/교환 방법</strong><br />
                    고객센터 또는 Q&A를 통해 접수 후 안내에 따라 반품해 주세요.
                </li>

                <li>
                    <strong>환불 처리 안내</strong><br />
                    반품 상품 확인 후 <b>영업일 기준 3~5일 이내</b> 환불 처리됩니다.
                </li>
            </ul>

        </div>

        <!-- 반품/교환 - IMAGE VERSION -->
        @* 
        <div id="return" class="tab-panel return-policy">
            <img src="/images/return-policy.jpg" class="return-img" />
        </div>
        *@

    </div>
</div>

<script>
    function changeImage(src) {
        document.querySelector(".main-img").src = src;
    }

    function openTab(el, id) {
        document.querySelectorAll(".tab")
            .forEach(t => t.classList.remove("active"));

        document.querySelectorAll(".tab-panel")
            .forEach(p => p.classList.remove("active"));

        el.classList.add("active");
        document.getElementById(id).classList.add("active");
    }
</script>

@section Scripts {
    <script src="~/js/qna.js" asp-append-version="true"></script>
}