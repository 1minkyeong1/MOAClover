@model MOAClover.Models.ViewModels.ProductDetailViewModel

@{
    ViewData["Title"] = "상품페이지";
}

<link rel="stylesheet" href="~/css/Detail.css" />

<div class="detail-wrap">

    <!-- 상단 -->
    <div class="detail-top">

        <!-- 왼쪽 이미지 -->
        <div class="detail-left">
            <img src="@Model.MainImageUrl" class="main-img" />

            <div class="thumbnail-wrap">
                @foreach (var img in Model.ImageUrls)
                {
                    <img src="@img" class="thumb" onclick="changeImage(this.src)" />
                }
            </div>
        </div>

        <!-- 오른쪽 상품정보 -->
        <div class="detail-right">
            <div class="category-info">
                카테고리
            </div>

            <h1>@Model.Name</h1>

            <!-- 가격 -->
            <div class="price-box">
                @if (Model.DiscountRate.HasValue)
                {
                    <div class="price-row">
                        <div class="discount-badge">@Model.DiscountRate%</div>

                        <div class="price-info">
                            <div class="final-price">
                                @Model.FinalPrice.ToString("N0") 원
                            </div>
                            <div class="origin-price">
                                <del>@Model.Price.ToString("N0") 원</del>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="final-price">
                        @Model.Price.ToString("N0") 원
                    </div>
                }
            </div>

            <div class="delivery">배송비: 3000원</div>

            <a href="https://smartstore.naver.com"
               target="_blank"
               class="external-link">
                스마트스토어
            </a>
        </div>
    </div>

    <!-- 탭 -->
    <div class="tab-menu">
        <div class="tab active" onclick="openTab(this,'detail')">상세정보</div>
        <div class="tab" onclick="openTab(this,'qa')">Q&A</div>
        <div class="tab" onclick="openTab(this,'return')">반품/교환</div>
    </div>

    <!-- 탭 내용 -->
    <div class="tab-content">

        <!-- 상세정보 -->
        <div id="detail" class="tab-panel active detail-html">

            @if (Model.ImageUrls.Any())
            {
                foreach (var img in Model.ImageUrls)
                {
                    <img src="@img" />
                }
            }

            @if (Model.VideoUrls.Any())
            {
                foreach (var video in Model.VideoUrls)
                {
                    <video src="@video" controls></video>
                }
            }

            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="text-desc">
                    @Html.Raw(Model.Description)
                </div>
            }

        </div>

        <!-- Q&A -->
        <div id="qa" class="tab-panel">

            @if (Model.QnAs == null || !Model.QnAs.Any())
            {
                <p class="qna-empty">아직 등록된 상품 문의가 없습니다.</p>
            }
            else
            {
                @foreach (var q in Model.QnAs)
                {
                    <div class="qna-box">
                        <div class="question">Q. @q.Question</div>

                        <div class="answer">
                            @(
                            string.IsNullOrEmpty(q.Answer)
                            ? "답변 대기중"
                            : "A. " + q.Answer
                            )
                    </div>
                </div>
                        }
            }

        </div>

        <!-- 반품/교환 -->
        <div id="return" class="tab-panel return-policy">

            <h3>반품 / 교환 안내</h3>

            <ul>
                <li>
                    <strong>반품/교환 가능 기간</strong><br />
                    상품 수령일로부터 <b>7일 이내</b>에 신청 가능합니다.
                </li>

                <li>
                    <strong>반품/교환 불가 사유</strong>
                    <ul class="sub">
                        <li>고객 부주의로 인한 상품 훼손 또는 사용 흔적이 있는 경우</li>
                        <li>상품 택(tag) 및 구성품이 분실 또는 훼손된 경우</li>
                        <li>주문 제작 상품 및 세일 상품</li>
                    </ul>
                </li>

                <li>
                    <strong>배송비 안내</strong><br />
                    단순 변심에 의한 반품/교환 시 왕복 배송비는 고객 부담입니다.<br />
                    상품 불량 및 오배송의 경우 배송비는 <b>판매자 부담</b>입니다.
                </li>

                <li>
                    <strong>반품/교환 방법</strong><br />
                    고객센터 또는 Q&A를 통해 접수 후 안내에 따라 반품해 주세요.
                </li>

                <li>
                    <strong>환불 처리 안내</strong><br />
                    반품 상품 확인 후 <b>영업일 기준 3~5일 이내</b> 환불 처리됩니다.
                </li>
            </ul>

        </div>

    </div>
</div>

<script>
    function changeImage(src) {
        document.querySelector(".main-img").src = src;
    }

    function openTab(el, id) {
        document.querySelectorAll(".tab")
            .forEach(t => t.classList.remove("active"));

        document.querySelectorAll(".tab-panel")
            .forEach(p => p.classList.remove("active"));

        el.classList.add("active");
        document.getElementById(id).classList.add("active");
    }
</script>