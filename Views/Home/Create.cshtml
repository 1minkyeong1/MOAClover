@{
    ViewData["Title"] = "상품 등록";
}

<link rel="stylesheet" href="~/css/Create.css" />

<form asp-action="Create"
      method="post"
      enctype="multipart/form-data">

    <div class="container">
        <h2>새 상품 등록</h2>

        <div class="input-box">
            <label>상품명</label>
            <input type="text" id="pName" name="Name" required>
        </div>

        <input type="hidden" id="finalCategoryId" name="CategoryId" />
        <div class="input-box">
            <label>카테고리</label>
            <div class="category-row">
                <select id="category1">
                    <option value="">대분류 선택</option>
                    @foreach (var c in ViewBag.Categories)
                    {
                        if (c.ParentCategoryId == null)
                        {
                            <option value="@c.CategoryId">@c.Name</option>
                        }
                    }
                </select>

                <select id="category2">
                    <option value="">중분류 선택</option>
                </select>

                <select id="category3">
                    <option value="">소분류 선택</option>
                </select>
            </div>
        </div>

        <div class="input-box">
            <label>가격</label>
            <input type="text" id="pPrice" name="Price" required>
        </div>

        <div class="input-box">
            <label>설명</label>
            <textarea id="pDesc" name="Description"></textarea>
        </div>

        <div class="input-box">
            <label>이미지</label>
            <input type="file" id="imgUpload" name="Images" multiple>
        </div>

        <div class="input-box">
            <label>영상 업로드</label>
            <input type="file" id="videoUpload" name="Video">
        </div>

        <button class="btn-save" type="submit">저장하기</button>

        <div>
            <a href="/Home/Index" class="btn-no">취소</a>
        </div>
    </div>
</form>

<script>
    const categories = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.Categories));

    const category1 = document.getElementById("category1");
    const category2 = document.getElementById("category2");
    const category3 = document.getElementById("category3");
    const finalCategoryId = document.getElementById("finalCategoryId");

    category1.addEventListener("change", function () {
        category2.innerHTML = '<option value="">중분류 선택</option>';
        category3.innerHTML = '<option value="">소분류 선택</option>';
        finalCategoryId.value = "";

        const selectedId = parseInt(this.value);
        if (!selectedId) return;

        categories
            .filter(c => c.ParentCategoryId === selectedId)
            .forEach(c => {
                category2.innerHTML += `<option value="${c.CategoryId}">${c.Name}</option>`;
            });
    });

    category2.addEventListener("change", function () {
        category3.innerHTML = '<option value="">소분류 선택</option>';
        finalCategoryId.value = "";

        const selectedId = parseInt(this.value);
        if (!selectedId) return;

        categories
            .filter(c => c.ParentCategoryId === selectedId)
            .forEach(c => {
                category3.innerHTML += `<option value="${c.CategoryId}">${c.Name}</option>`;
            });
    });

    category3.addEventListener("change", function () {
        finalCategoryId.value = this.value;
    });
</script>
